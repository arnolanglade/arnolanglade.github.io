<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>How to use custom React hook to increase application testability</title>
  <meta name='description' content='Sometimes, we depend on libraries that provide components which cannot be well rendered in the test environment. That means we cannot test some parts of an a...'>
  <meta name="keywords" content="react,reactjs,hook,javascript,typescript,coupling,software,testing">
  <link rel="canonical" href="https://arnolanglade.github.io/how-to-use-custom-react-hook-to-increase-application-testability.html">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="How to use custom React hook to increase application testability – Arnaud Langlade - Senior software engineer, software architect, and technical coach">
  <meta name="twitter:description" content="Sometimes, we depend on libraries that provide components which cannot be well rendered in the test environment. That means we cannot test some parts of an application. Learn how to use a React hook to prevent that problem and increase the application testability in this new blog article.">
  <meta name="twitter:image:src" content="https://arnolanglade.github.io/how-to-use-custom-react-hook-to-increase-application-testability.webp">

  <!-- Facebook OpenGraph -->
  <meta property="og:title" content="How to use custom React hook to increase application testability – Arnaud Langlade - Senior software engineer, software architect, and technical coach">
  <meta property="og:description" content="Sometimes, we depend on libraries that provide components which cannot be well rendered in the test environment. That means we cannot test some parts of an application. Learn how to use a React hook to prevent that problem and increase the application testability in this new blog article.">
  <meta property="og:image" content="https://arnolanglade.github.io/how-to-use-custom-react-hook-to-increase-application-testability.webp">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

  <!-- Ionicons -->
  <link href="https://unpkg.com/ionicons@4.5.0/dist/css/ionicons.min.css" rel="stylesheet">

  <link rel="stylesheet" href="/assets/main.css">
</head>


<body>

    
<script src="https://getinsights.io/js/insights.js"></script>
<script>
    insights.init('VoIrQveDE0uUwpQi');
    insights.trackPages({
        hash: true,
        search: true
    });
</script>
<script type="text/javascript">
    (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
        for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
        MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);

    mixpanel.init('ebca5edb0d7861434aefdf18e32fe9d4');
    mixpanel.track('viewed_page');
</script>



    <!-- begin header -->
<header class="c-header">
  <div class="container">
    <div class="row">
      <div class="c-header__inner">

        <div class="logo">
          <a class="logo__link" href="/">
          
            Langlade Arnaud
          
          </a>
        </div>

        <nav class="main-nav">
          <div class="main-nav__box">

            <div class="nav__icon-close">
              <i class="ion ion-md-close"></i>
            </div>

            <div class="nav__title">Menu</div>

              <ul class="nav__list list-reset">

              
                
                <li class="nav__item">
                  <a href="/" class="nav__link">Home</a>
                </li>
                
              
                
                <li class="nav__item dropdown">
                  <span class="nav__link dropdown-toggle">About me <i class="ion ion-ios-arrow-down arrow-down"></i></span>
                  <div class="dropdown-menu">
                    
                      <a href="/about/" class="nav__link">About me</a>
                    
                      <a href="/experiences/" class="nav__link">My experiences</a>
                    
                      <a href="/talks/" class="nav__link">My talks</a>
                    
                  </div>
                </li>

                
              
                
                <li class="nav__item">
                  <a href="/blog/" class="nav__link">Blog</a>
                </li>
                
              
                
                <li class="nav__item">
                  <a href="/mikado-app/" class="nav__link">MikadoApp</a>
                </li>
                
              
                
                <li class="nav__item">
                  <a href="/contact/" class="nav__link">Contact</a>
                </li>
                
              

            </ul>
          </div>

          <!--bookshop-live name(social-link.jekyll.html) params() context() -->
          
<div class="social">
  <ul class="social__list list-reset">
    
    <li class="social__item">
      <a class="social__link" href="https://twitter.com/arnolanglade" target="_blank" rel="noopener" aria-label="logo-twitter icon">
        <i class="ion ion-logo-twitter"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://github.com/arnolanglade" target="_blank" rel="noopener" aria-label="logo-github icon">
        <i class="ion ion-logo-github"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://www.linkedin.com/in/arnolanglade" target="_blank" rel="noopener" aria-label="logo-linkedin icon">
        <i class="ion ion-logo-linkedin"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://www.youtube.com/@arnolanglade" target="_blank" rel="noopener" aria-label="logo-youtube icon">
        <i class="ion ion-logo-youtube"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="mailto:arnaud.langlade@gmail.com" target="_blank" rel="noopener" aria-label="md-mail icon">
        <i class="ion ion-md-mail"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="/feed.xml" target="_blank" rel="noopener" aria-label="logo-rss icon">
        <i class="ion ion-logo-rss"></i>
      </a>
    </li>
    
  </ul>
</div>


          <!--bookshop-live end-->
        </nav>

        <div class="nav-button">
          <i class="nav__icon nav__icon-menu ion ion-md-menu"></i>
        </div>

      </div>
    </div>
  </div>
</header>
<!-- end header -->


    <div class="post-top">
  <div class="container">
    <div class="row">

      
      <div class="col col-6 col-d-12">
        <div class="post-image">
          <img loading="lazy" src="/images/posts/how-to-use-custom-react-hook-to-increase-application-testability.webp" alt="How to use custom React hook to increase application testability">
        </div>
      </div>
      

      <div class="col col-6 col-d-12">
        <div class="post__info">

          
          <div class="post-tags">
            
              <a href="/tag/react" class="post-tags__tag">react</a>
            
              <a href="/tag/testing" class="post-tags__tag">testing</a>
            
          </div>
          

          <h1 class="post__title">How to use custom React hook to increase application testability</h1>

          <div class="post__meta">
            <div class="post__meta-bottom">
              <time class="post__date" datetime="2023-04-04T00:00:00-05:00">
                04 Apr 2023
              </time>
              
              <p class="post__image-credit">
                Picture: <a class="post__image-credit-link" href="https://unsplash.com/@joetography">@joetography</a>
              </p>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- begin post -->
<div class="container animate">

  <article class="post">

    <div class="post__content">
      <p>In my previous blog, I spoke about reducing coupling in a React app to improve testing. Now I will show you how a custom React hook can increase testability.</p>

<p><strong>Note:</strong> I assume that you are comfortable with React hooks. If you aren’t, please have a look at the <a href="https://reactjs.org/docs/hooks-intro.html">React documentation</a></p>

<p>First of all, I will show you some code that is not testable. In my <a href="https://mymaps.world">side project</a>, I use <code class="language-plaintext highlighter-rouge">react-map-gl</code> to create maps with <a href="https://www.mapbox.com/">Mapbox</a>. Unfortunately, I can’t render the map with the testing library because this library only works in a web browser. I might have done something wrong but I haven’t found any solution to solve this problem.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">MapPage</span><span class="p">()</span> <span class="p">{</span>
   <span class="kd">const</span> <span class="p">{</span><span class="nx">mapId</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useParams</span><span class="o">&lt;</span><span class="p">{</span> <span class="na">mapId</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">();</span>
   <span class="kd">const</span> <span class="p">[</span><span class="nx">markers</span><span class="p">,</span> <span class="nx">setMarkers</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([]);</span>
   <span class="kd">const</span> <span class="p">[</span><span class="nx">isMarkerOpened</span><span class="p">,</span> <span class="nx">setIsMarkerOpened</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>


   <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="nx">setMarkers</span><span class="p">(</span><span class="nx">getMarkers</span><span class="p">(</span><span class="nx">mapId</span><span class="p">));</span>
   <span class="p">},</span> <span class="p">[</span><span class="nx">mapId</span><span class="p">]);</span>


   <span class="kd">const</span> <span class="nx">openMarkerPopup</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">setIsMarkerOpened</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
   <span class="kd">const</span> <span class="nx">closeMarkerPopup</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">setIsMarkerOpened</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>


   <span class="k">return</span> <span class="p">(</span>
       <span class="p">&lt;&gt;</span>
           <span class="p">&lt;</span><span class="nc">ReactMapGL</span><span class="p">&gt;</span>
               <span class="si">{</span><span class="nx">markers</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
                   <span class="p">(</span><span class="nx">marker</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nc">Marker</span>
                       <span class="na">longitude</span><span class="p">=</span><span class="si">{</span><span class="nx">marker</span><span class="p">.</span><span class="nx">longitude</span><span class="si">}</span>
                       <span class="na">latitude</span><span class="p">=</span><span class="si">{</span><span class="nx">marker</span><span class="p">.</span><span class="nx">latitude</span><span class="si">}</span>
                   <span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nc">MarkerIcon</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">openMarkerPopup</span><span class="si">}</span> <span class="p">/&gt;</span>
                   <span class="p">&lt;/</span><span class="nc">Marker</span><span class="p">&gt;</span>
               <span class="p">)</span><span class="si">}</span>
           <span class="p">&lt;/</span><span class="nc">ReactMapGL</span><span class="p">&gt;</span>
           <span class="p">&lt;</span><span class="nc">MarkerPopup</span> <span class="na">isOpened</span><span class="p">=</span><span class="si">{</span><span class="nx">isMarkerOpened</span><span class="si">}</span> <span class="na">onClose</span><span class="p">=</span><span class="si">{</span><span class="nx">closeMarkerPopup</span><span class="si">}</span> <span class="p">/&gt;</span>
       <span class="p">&lt;/&gt;</span>
   <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">MapPage</code> is in charge of loading map data depending on the <code class="language-plaintext highlighter-rouge">mapId</code> and rendering a map with its markers. I can’t test the <code class="language-plaintext highlighter-rouge">MapBoard</code> component because the <code class="language-plaintext highlighter-rouge">ReactMapGL</code> component can’t be rendered through the test tooling. That’s sad because I still want to check if I can open the marker popup when a user clicks on a marker.</p>

<p>React will help us to fix this issue! We need to refactor this component to extract the business logic into a hook. This way, the component will only be responsible for rendering things. Let’s begin by creating the hooks.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">useMapPage</span><span class="p">(</span><span class="nx">mapId</span><span class="p">,</span> <span class="p">{</span><span class="nx">defaultIsMarkerOpened</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="na">defaultIsMarkerOpened</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span> <span class="p">{</span>
   <span class="kd">const</span> <span class="p">[</span><span class="nx">markers</span><span class="p">,</span> <span class="nx">setMarkers</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([]);</span>
   <span class="kd">const</span> <span class="p">[</span><span class="nx">isMarkerOpened</span><span class="p">,</span> <span class="nx">setIsMarkerOpened</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="nx">defaultIsMarkerOpened</span><span class="p">);</span>


   <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="nx">setMarkers</span><span class="p">(</span><span class="nx">getMarkers</span><span class="p">(</span><span class="nx">mapId</span><span class="p">));</span>
   <span class="p">},</span> <span class="p">[</span><span class="nx">mapId</span><span class="p">]);</span>


   <span class="kd">const</span> <span class="nx">openMarkerPopup</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">setIsMarkerOpened</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
   <span class="kd">const</span> <span class="nx">closeMarkerPopup</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">setIsMarkerOpened</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>


   <span class="k">return</span> <span class="p">{</span>
       <span class="nx">markers</span><span class="p">,</span>
       <span class="nx">isMarkerOpened</span><span class="p">,</span>
       <span class="nx">closeMarkerPopup</span><span class="p">,</span>
       <span class="nx">openMarkerPopup</span><span class="p">,</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>The hook exposes two variables: <code class="language-plaintext highlighter-rouge">markers</code> which is an array of map’s markers and <code class="language-plaintext highlighter-rouge">isMarkerOpened</code> which is a boolean that indicates if the popup is opened or closed. It exposes two functions, <code class="language-plaintext highlighter-rouge">openMarkerPopup</code> and <code class="language-plaintext highlighter-rouge">closeMarkerPopup</code> that let us mutate the <code class="language-plaintext highlighter-rouge">isMarkerOpened</code> boolean.</p>

<p><strong>Note:</strong> We could only expose <code class="language-plaintext highlighter-rouge">setIsMarkerOpened</code> but I think <code class="language-plaintext highlighter-rouge">openMarkerPopup</code> and <code class="language-plaintext highlighter-rouge">closeMarkerPopup</code> function names are clearer and match the component logic.</p>

<p>Now, we need to call the hook from the <code class="language-plaintext highlighter-rouge">MapPage</code> component and it will still work as before.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">MapPage</span><span class="p">()</span> <span class="p">{</span>
   <span class="kd">const</span> <span class="p">{</span>
       <span class="nx">markers</span><span class="p">,</span>
       <span class="nx">isMarkerOpened</span><span class="p">,</span>
       <span class="nx">closeMarkerPopup</span><span class="p">,</span>
       <span class="nx">openMarkerPopup</span>
   <span class="p">}</span> <span class="o">=</span> <span class="nx">useMapPage</span><span class="p">(</span><span class="nx">mapId</span><span class="p">);</span>


   <span class="k">return</span> <span class="p">(</span>
       <span class="p">&lt;&gt;</span>
           <span class="p">&lt;</span><span class="nc">ReactMapGL</span><span class="p">&gt;</span>
               <span class="si">{</span><span class="nx">markers</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
                   <span class="p">(</span><span class="nx">marker</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nc">Marker</span>
                       <span class="na">longitude</span><span class="p">=</span><span class="si">{</span><span class="nx">marker</span><span class="p">.</span><span class="nx">longitude</span><span class="si">}</span>
                       <span class="na">latitude</span><span class="p">=</span><span class="si">{</span><span class="nx">marker</span><span class="p">.</span><span class="nx">latitude</span><span class="si">}</span>
                   <span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nc">MarkerIcon</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">openMarkerPopup</span><span class="si">}</span> <span class="p">/&gt;</span>
                   <span class="p">&lt;/</span><span class="nc">Marker</span><span class="p">&gt;</span>
               <span class="p">)</span><span class="si">}</span>
           <span class="p">&lt;/</span><span class="nc">ReactMapGL</span><span class="p">&gt;</span>
           <span class="p">&lt;</span><span class="nc">MarkerPopup</span> <span class="na">isOpened</span><span class="p">=</span><span class="si">{</span><span class="nx">isMarkerOpened</span><span class="si">}</span> <span class="na">onClose</span><span class="p">=</span><span class="si">{</span><span class="nx">closeMarkerPopup</span><span class="si">}</span> <span class="p">/&gt;</span>
       <span class="p">&lt;/&gt;</span>
   <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">MapPage</code> is still untestable but we can start testing the hook to ensure hook logic matches business expectations. We can test if we can open a marker’s popup. That’s great because the testing library provides the <code class="language-plaintext highlighter-rouge">renderHook</code> helper that eases the hook testing.</p>

<p><strong>Note:</strong> If you want to know how <code class="language-plaintext highlighter-rouge">renderHook</code> works you should have a look at this <a href="https://kentcdodds.com/blog/how-to-test-custom-react-hooks">blog post</a> written by <a href="https://twitter.com/kentcdodds">Kent C. Dodds</a>.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Map Page</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">should open the marker popup</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="kd">const</span> <span class="p">{</span> <span class="nx">result</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">renderHook</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">useMapPage</span><span class="p">(</span>
           <span class="dl">'</span><span class="s1">mapId</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">defaultIsMarkerOpened</span><span class="p">:</span> <span class="kc">false</span><span class="p">}</span>
       <span class="p">));</span>
       
       <span class="nx">act</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">result</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">openMarkerPopup</span><span class="p">());</span>
       
       <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">isMarkerOpened</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
   <span class="p">});</span>


   <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">should close the marker popup</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="kd">const</span> <span class="p">{</span> <span class="nx">result</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">renderHook</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">useMapPage</span><span class="p">(</span>
           <span class="dl">'</span><span class="s1">mapId</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">defaultIsMarkerOpened</span><span class="p">:</span> <span class="kc">true</span><span class="p">}</span>
       <span class="p">));</span>
       
       <span class="nx">act</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">result</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">closeMarkerPopup</span><span class="p">());</span>

       <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">isMarkerOpened</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
   <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>As I said at the beginning of this blog post I wrote a blog post to explain how to reduce coupling in a React application. Please, have a look at this <a href="/how-to-reduce-coupling-in-your-react-app.html">blog post</a> to understand how to make a dependency injection system.</p>

<p>Now, we need to remove the <code class="language-plaintext highlighter-rouge">getMarkers</code> function call from the hooks if we want to test the map data loading. We don’t want to trigger side effects like HTTP calls in the unit test suite because we want to have the shortest feedback loop. We will get the <code class="language-plaintext highlighter-rouge">getMarkers</code> function to <code class="language-plaintext highlighter-rouge">useServiceContainer</code> which is a hook that provides any services.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">useMapPage</span><span class="p">(</span><span class="nx">mapId</span><span class="p">,</span> <span class="p">{</span><span class="nx">defaultIsMarkerOpened</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="na">defaultIsMarkerOpened</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span> <span class="p">{</span>
   <span class="kd">const</span> <span class="p">{</span><span class="nx">getMarkers</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useServiceContainer</span><span class="p">();</span>
   <span class="c1">// ...</span>
  
   <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="nx">setMarkers</span><span class="p">(</span><span class="nx">getMarkers</span><span class="p">(</span><span class="nx">mapId</span><span class="p">));</span>
   <span class="p">},</span> <span class="p">[</span><span class="nx">mapId</span><span class="p">]);</span>
   <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By default, the <code class="language-plaintext highlighter-rouge">useServiceContainer</code> hooks return the production services, we will need to replace the <code class="language-plaintext highlighter-rouge">getMarkers</code> service with a fake service for testing purposes. The  <code class="language-plaintext highlighter-rouge">useServiceContainer</code> hooks can’t work without a React Provider. I like to create a factory that wraps components I test with all needed providers. It avoids a lot of noise in the test suites and makes tests more readable.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">createWrapper</span> <span class="o">=</span> <span class="p">(</span><span class="nx">serviceContainer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kd">function</span> <span class="nx">Wrapper</span><span class="p">(</span>
   <span class="p">{</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">ReactElement</span> <span class="p">},</span>
<span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="p">(</span>
       <span class="p">&lt;</span><span class="nc">ContainerContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">serviceContainer</span><span class="si">}</span><span class="p">&gt;</span>
           <span class="si">{</span><span class="nx">children</span><span class="si">}</span>
       <span class="p">&lt;/</span><span class="nc">ContainerContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">&gt;</span>
   <span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Note: the factory has a parameter which is the service container. It will let us define the services we want to override for testing.</p>

<p>The <code class="language-plaintext highlighter-rouge">renderHook</code> has a <code class="language-plaintext highlighter-rouge">wrapper</code> option that lets you define the component that will wrap the hook you are testing. We will use the <code class="language-plaintext highlighter-rouge">createWrapper</code> factory to wrap the hook into the <code class="language-plaintext highlighter-rouge">ContainerContext</code> provider and we create a fake <code class="language-plaintext highlighter-rouge">getMarkers</code> service.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Map Page</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">should load the markers of the map</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="kd">const</span> <span class="nx">markers</span> <span class="o">=</span> <span class="p">[{</span><span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">makerId</span><span class="dl">'</span><span class="p">}];</span>
       <span class="kd">const</span> <span class="p">{</span> <span class="nx">result</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">renderHook</span><span class="p">(</span>
           <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">useMapPage</span><span class="p">(</span><span class="dl">'</span><span class="s1">mapId</span><span class="dl">'</span><span class="p">),</span>
           <span class="p">{</span><span class="na">wrapper</span><span class="p">:</span> <span class="nx">createWrapper</span><span class="p">({</span><span class="na">getMarkers</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">markers</span><span class="p">})}</span>
       <span class="p">);</span>
       
       <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">markers</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">markers</span><span class="p">);</span>
   <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Now, the <code class="language-plaintext highlighter-rouge">getMarkers</code> is predictable. That means we can test the map loading because the <code class="language-plaintext highlighter-rouge">getMarker</code> function will return <code class="language-plaintext highlighter-rouge">[{id: 'makerId'}]</code> every time.</p>

<p>Thanks to my proofreader <a href="https://www.linkedin.com/in/laurebrosseau">@LaureBrosseau</a>.</p>

    </div>

    <div class="post__share">
  <div class="share__head">
    <div class="share__title"><i class="ion ion-md-heart"></i> Share it if you like it!</div>
  </div>
  <ul class="share__list list-reset">
    <li class="share__item">
      <a class="share__link share__twitter"
        href="https://twitter.com/intent/tweet?text=How%20to%20use%20custom%20React%20hook%20to%20increase%20application%20testability&url=https://arnolanglade.github.io/how-to-use-custom-react-hook-to-increase-application-testability.html"
        onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
        title="Share on Twitter" rel="nofollow"><i class="ion ion-logo-twitter"></i></a>
    </li>
    <li class="share__item">
      <a class="share__link share__facebook"
        href="https://www.facebook.com/sharer/sharer.php?u=https://arnolanglade.github.io/how-to-use-custom-react-hook-to-increase-application-testability.html"
        onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
        title="Share on Facebook" rel="nofollow"><i class="ion ion-logo-facebook"></i></a>
    </li>
    <li class="share__item">
      <a class="share__link share__linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&url=https://arnolanglade.github.io/how-to-use-custom-react-hook-to-increase-application-testability.html&title=How%20to%20use%20custom%20React%20hook%20to%20increase%20application%20testability&summary=Sometimes,%20we%20depend%20on%20libraries%20that%20provide%20components%20which%20cannot%20be%20well%20rendered%20in%20the%20test%20environment.%20That%20means%20we%20cannot%20test%20some%20parts%20of%20an%20application.%20Learn%20how%20to%20use%20a%20React%20hook%20to%20prevent%20that%20problem%20and%20increase%20the%20application%20testability%20in%20this%20new%20blog%20article.&source=Arnaud%20Langlade"
        onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
        title="Share on LinkedIn" rel="nofollow"><i class="ion ion-logo-linkedin"></i></a>
    </li>
  </ul>
</div>


  </article>
</div>
<!-- end post -->

<!--bookshop-live name(newsletter/newsletter.jekyll.html) params(newsletter_title=site.data.newsletter.newsletter_title
newsletter_description=site.data.newsletter.newsletter_description
newsletter_identifier=site.data.newsletter.newsletter_identifier
newsletter_button=site.data.newsletter.newsletter_button) context() -->
          <!-- begin subscribe -->

<section class="c-subscribe section">
  <div class="container">
    <div class="row">
      <div class="col col-12">

        <div class="c-subscribe__inner">
          <div class="c-subscribe__info">
            <h3 class="c-subscribe__title">Join my mailing list</h3>
            <div class="c-subscribe__subtitle">
              <span id="ityped"></span>
            </div>
          </div>

          <form class="c-subscribe__form validate" action="https://gmail.us13.list-manage.com/subscribe/post"
            method="POST" id="membedded-subscribe-form" name="membedded-subscribe-form" target="_blank" novalidate>
            <input type="hidden" name="u" value="d7313775f348f8c8d39a841a0">
            <input type="hidden" name="id" value="28bcb90eaa">
            <input type="hidden" name="orig-lang" value="1">
            <label class="screen-reader-text" for="mce-EMAIL">Email address</label>
            <input class="c-subscribe__form-email required email" id="mce-EMAIL" type="text" name="MERGE0" placeholder="Your email address">
            <button class="c-button c-button--primary c-button--large" id="membedded-subscribe" type="submit" name="subscribe">Subscribe</button>
          </form>

        </div>
      </div>
    </div>
  </div>
</section>
<!-- end subscribe -->

<script>
  var itype_text = ['Get inspiration, updates and, cool stuff!'];
</script>
          <!--bookshop-live end-->







<!-- begin related posts -->
<div class="container">
  <section class="related-posts is-related animate">
    <div class="row">
      <div class="col col-12">
        <div class="container__inner">
          <div class="section__info">
            <div class="section__head">
              <h2 class="section__title">You may also like</h2>
              <a class="section__link" href="/blog">
                
                
                  
                    <a href="/tag/react" class="section__link related-tag">See all<span> react</span> <i class="ion ion-md-arrow-forward"></i></a>
                  
                
                  
                
              
              </a>
            </div>
          </div>
          <div class="row">

          
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            

            <!--bookshop-live name(blog-card/blog-card.jekyll.html) params(post=post) context(post=site.posts[3]) -->
          
<div class="c-blog-card col col-4 col-d-6 col-t-12">
  <div class="c-blog-card__inner">

    
    <div class="c-blog-card__image-wrap">
      <a class="c-blog-card__image" href="/why-breaking-encapsulation-is-not-a-good-idea.html">
        <img loading="lazy" src="/images/posts/why-breaking-encapsulation-is-not-a-good-idea/why-breaking-encapsulation-is-not-a-good-idea.webp" alt="Why breaking encapsulation is not a good idea">
      </a>
    </div>
    

    <div class="c-blog-card__content">

      
      <div class="c-blog-card__tags-box">
        
        <a href="/tag/testing" class="c-blog-card__tag">testing</a>
        
        <a href="/tag/oop" class="c-blog-card__tag">OOP</a>
        
      </div>
      

      <h2 class="c-blog-card__title">
        <a href="/why-breaking-encapsulation-is-not-a-good-idea.html">Why breaking encapsulation is not a good idea</a>
      </h2>

      <p class="c-blog-card__excerpt">
        This principle restricts direct access to the state of the object from outside. This means that the internal implementation details of a class are hidden. Accessing the state of the object is only allowed through its public API (public methods). This concept helps to protect the data from outside interference and ensures controlled and secure data manipulation.
      </p>

      <div class="c-blog-card__meta">
        <div class="c-blog-card__info">
          <span class="c-blog-card__date"><time datetime="2023-09-19T00:00:00-05:00">19 Sep 2023</time></span>
        </div>
      </div>
    </div>
  </div>
</div>

          <!--bookshop-live end-->

            
                
              
            
            
            

            

            

            <!--bookshop-live name(blog-card/blog-card.jekyll.html) params(post=post) context(post=site.posts[4]) -->
          
<div class="c-blog-card col col-4 col-d-6 col-t-12">
  <div class="c-blog-card__inner">

    
    <div class="c-blog-card__image-wrap">
      <a class="c-blog-card__image" href="/do-not-test-private-methods.html">
        <img loading="lazy" src="/images/posts/do-not-test-private-method/do-not-test-private-methods.webp" alt="Don’t test private methods">
      </a>
    </div>
    

    <div class="c-blog-card__content">

      
      <div class="c-blog-card__tags-box">
        
        <a href="/tag/testing" class="c-blog-card__tag">testing</a>
        
        <a href="/tag/oop" class="c-blog-card__tag">OOP</a>
        
      </div>
      

      <h2 class="c-blog-card__title">
        <a href="/do-not-test-private-methods.html">Don’t test private methods</a>
      </h2>

      <p class="c-blog-card__excerpt">
        One of the first mistakes I made when I started to test my code was to test private methods. Spoiler alert: it was a bad idea! If you need to test a private method, it probably means that your code is not well designed. Private methods are implementation details of objects and we should not care about them. When you test public methods you also test the private ones.
      </p>

      <div class="c-blog-card__meta">
        <div class="c-blog-card__info">
          <span class="c-blog-card__date"><time datetime="2023-07-17T00:00:00-05:00">17 Jul 2023</time></span>
        </div>
      </div>
    </div>
  </div>
</div>

          <!--bookshop-live end-->

            
                
              
            
            
            

            

            

            <!--bookshop-live name(blog-card/blog-card.jekyll.html) params(post=post) context(post=site.posts[5]) -->
          
<div class="c-blog-card col col-4 col-d-6 col-t-12">
  <div class="c-blog-card__inner">

    
    <div class="c-blog-card__image-wrap">
      <a class="c-blog-card__image" href="/ease-testing-thanks-to-the-dependency-inversion-design-pattern.html">
        <img loading="lazy" src="/images/posts/inversion-dependency/ease-testing-thanks-to-the-dependency-inversion-design-pattern.webp" alt="Ease testing thanks to the dependency inversion design pattern">
      </a>
    </div>
    

    <div class="c-blog-card__content">

      
      <div class="c-blog-card__tags-box">
        
        <a href="/tag/testing" class="c-blog-card__tag">testing</a>
        
        <a href="/tag/design-pattern" class="c-blog-card__tag">design-pattern</a>
        
        <a href="/tag/oop" class="c-blog-card__tag">OOP</a>
        
      </div>
      

      <h2 class="c-blog-card__title">
        <a href="/ease-testing-thanks-to-the-dependency-inversion-design-pattern.html">Ease testing thanks to the dependency inversion design pattern</a>
      </h2>

      <p class="c-blog-card__excerpt">
        The inversion design pattern is quite simple and super powerful. It makes your code more modular. It lets you change a class's dependency to another one depending on the context. It is a good way to decouple your code from IO to make it testable.
      </p>

      <div class="c-blog-card__meta">
        <div class="c-blog-card__info">
          <span class="c-blog-card__date"><time datetime="2023-06-19T00:00:00-05:00">19 Jun 2023</time></span>
        </div>
      </div>
    </div>
  </div>
</div>

          <!--bookshop-live end-->

            
                
                  
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
<!-- end related posts -->



  <!-- begin comments -->
<div class="container">
  <div class="row">
    <div class="col col-12">
      <div class="disqus-inner">
        <div id="disqus_thread" class="post__comments">
          <div id="disqus_empty"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function load_disqus() {
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://arnaudlanglade.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  window.addEventListener('scroll', function (e) {
    var currentScroll = document.scrollingElement.scrollTop;
    var disqus_target = document.getElementById('disqus_thread');
    var disqus_empty = document.getElementById('disqus_empty');

    if (disqus_target && disqus_empty && (currentScroll > disqus_target.getBoundingClientRect().top - 150)) {
      load_disqus();
    }
  }, false);

</script>
<noscript>Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- end comments -->





    <!--
        Bookshop components are accessed using the bookshop tag,
        using the same syntax as the standard Jekyll include tag.
    -->
    <!--bookshop-live name(page.jekyll.html) params(content_blocks=page.content_blocks page_theme=page.page_theme) context() -->
          
          <!--bookshop-live end-->

    <div class="top" title="Top"><i class="ion ion-ios-arrow-up"></i></div>

    <!-- begin footer -->
<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col col-12">

        <!--bookshop-live name(social-link.jekyll.html) params() context() -->
          
<div class="social">
  <ul class="social__list list-reset">
    
    <li class="social__item">
      <a class="social__link" href="https://twitter.com/arnolanglade" target="_blank" rel="noopener" aria-label="logo-twitter icon">
        <i class="ion ion-logo-twitter"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://github.com/arnolanglade" target="_blank" rel="noopener" aria-label="logo-github icon">
        <i class="ion ion-logo-github"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://www.linkedin.com/in/arnolanglade" target="_blank" rel="noopener" aria-label="logo-linkedin icon">
        <i class="ion ion-logo-linkedin"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://www.youtube.com/@arnolanglade" target="_blank" rel="noopener" aria-label="logo-youtube icon">
        <i class="ion ion-logo-youtube"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="mailto:arnaud.langlade@gmail.com" target="_blank" rel="noopener" aria-label="md-mail icon">
        <i class="ion ion-md-mail"></i>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="/feed.xml" target="_blank" rel="noopener" aria-label="logo-rss icon">
        <i class="ion ion-logo-rss"></i>
      </a>
    </li>
    
  </ul>
</div>


          <!--bookshop-live end-->

        <ul class="footer_nav list-reset">
          
          <li class="footer_nav__item">
            <a href="/" class="footer_nav__link">Home</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/about/" class="footer_nav__link">About me</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/experiences/" class="footer_nav__link">My experiences</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/talks/" class="footer_nav__link">My talks</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/contact/" class="footer_nav__link">Contact</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/blog/" class="footer_nav__link">Blog</a>
          </li>
          
        </ul>

        <div class="copyright"><p> 2021 &copy; Langlade Arnaud. Template by <a href="https://cloudcannon.com/">CloudCannon</a>.</p></div>

      </div>
    </div>
  </div>
</footer>
<!-- end footer -->

    <!--
        load the live component for CloudCannon live previews.
    -->
    <script>
(function(){
  const bookshopLiveSetup = (CloudCannon) => {
    CloudCannon.enableEvents();

    const head = document.querySelector('head');
    const script = document.createElement('script');
    script.src = `/_cloudcannon/bookshop-live.js`;
    script.onload = function() {
      window.bookshopLive = new window.BookshopLive({
        remoteGlobals: ['/_cloudcannon/bookshop-site-data.json']
      });
      const updateBookshopLive = async () => {
        const frontMatter = await CloudCannon.value();
        const options = window.bookshopLiveOptions || {};
        await window.bookshopLive.update({page: frontMatter}, options);
        CloudCannon?.refreshInterface?.();
      }
      document.addEventListener('cloudcannon:update', updateBookshopLive);
      updateBookshopLive();
    }
    head.appendChild(script);
  }

  document.addEventListener('cloudcannon:load', function (e) {
    bookshopLiveSetup(e.detail.CloudCannon);
  });
})();
</script>

    <script src="/js/scripts.js"></script>
    <script src="/js/common.js"></script>
    <script id="dsq-count-scr" src="//arnaudlanglade.disqus.com/count.js" async></script>
</body>
</html>
