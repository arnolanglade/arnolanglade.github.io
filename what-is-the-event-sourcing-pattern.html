<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>What is the event sourcing pattern?</title>
  <meta name='description' content='Event sourcing consists in storing all changes that happened to the application state as a sequence of events instead of only storing the current state of th...'>
  <meta name="keywords" content="software,software architecture,design patterns,es,event sourcing,table soccer">
  <link rel="canonical" href="https://arnolanglade.github.io/what-is-the-event-sourcing-pattern.html">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="What is the event sourcing pattern? – Arnaud Langlade - Senior software engineer, software architect, and technical coach">
  <meta name="twitter:description" content="Event sourcing consists in storing all changes that happened to the application state as a sequence of events instead of only storing the current state of the application. The sum of all events makes  the current application state.">
  <meta name="twitter:image:src" content="https://arnolanglade.github.io/what-is-the-event-sourcing-pattern.webp">

  <!-- Facebook OpenGraph -->
  <meta property="og:title" content="What is the event sourcing pattern? – Arnaud Langlade - Senior software engineer, software architect, and technical coach">
  <meta property="og:description" content="Event sourcing consists in storing all changes that happened to the application state as a sequence of events instead of only storing the current state of the application. The sum of all events makes  the current application state.">
  <meta property="og:image" content="https://arnolanglade.github.io/what-is-the-event-sourcing-pattern.webp">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

  <!-- Ionicons -->
  <link href="https://unpkg.com/ionicons@4.5.0/dist/css/ionicons.min.css" rel="stylesheet">

  <link rel="stylesheet" href="/assets/main.css">
  <script id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/d7313775f348f8c8d39a841a0/e700de66f691879b2812dc95e.js");</script>
</head>


<body>

    
<script src="https://getinsights.io/js/insights.js"></script>
<script>
    insights.init('VoIrQveDE0uUwpQi');
    insights.trackPages({
        hash: true,
        search: true
    });
</script>
<script type="text/javascript">
    (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
        for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
        MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);

    mixpanel.init('ebca5edb0d7861434aefdf18e32fe9d4');
    mixpanel.track('viewed_page');
</script>



    <!-- begin header -->
<header class="c-header">
  <div class="container">
    <div class="row">
      <div class="c-header__inner">

        <div class="logo">
          <a class="logo__link" href="/">
          
            Langlade Arnaud
          
          </a>
        </div>

        <nav class="main-nav">
          <div class="main-nav__box">

            <div class="nav__icon-close">
              <i class="ion ion-md-close"></i>
            </div>

            <div class="nav__title">Menu</div>

              <ul class="nav__list list-reset">

              
                
                <li class="nav__item">
                  <a href="/" class="nav__link">Home</a>
                </li>
                
              
                
                <li class="nav__item dropdown">
                  <span class="nav__link dropdown-toggle">About me <i class="ion ion-ios-arrow-down arrow-down"></i></span>
                  <div class="dropdown-menu">
                    
                      <a href="/about/" class="nav__link">About me</a>
                    
                      <a href="/experiences/" class="nav__link">My experiences</a>
                    
                      <a href="/talks/" class="nav__link">My talks</a>
                    
                  </div>
                </li>

                
              
                
                <li class="nav__item">
                  <a href="/blog/" class="nav__link">Blog</a>
                </li>
                
              
                
                <li class="nav__item">
                  <a href="/mikado-app/" class="nav__link">MikadoApp</a>
                </li>
                
              
                
                <li class="nav__item">
                  <a href="/contact/" class="nav__link">Contact</a>
                </li>
                
              

            </ul>
          </div>

          <!--bookshop-live name(social-link.jekyll.html) params() context() -->
          
<div class="social">
  <ul class="social__list list-reset">
    
    <li class="social__item">
      <a class="social__link" href="https://twitter.com/arnolanglade" target="_blank" rel="noopener" aria-label="twitter icon">
        <img loading="lazy" src="/images/logos/twitter.webp" alt="twitter"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://www.linkedin.com/in/arnolanglade" target="_blank" rel="noopener" aria-label="linkedin icon">
        <img loading="lazy" src="/images/logos/linkedin.webp" alt="linkedin"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://bsky.app/profile/arnolanglade.bsky.social" target="_blank" rel="noopener" aria-label="bluesky icon">
        <img loading="lazy" src="/images/logos/bluesky.webp" alt="bluesky"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://mastodon.social/@arnolanglade" target="_blank" rel="noopener" aria-label="mastodon icon">
        <img loading="lazy" src="/images/logos/mastodon.webp" alt="mastodon"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://github.com/arnolanglade" target="_blank" rel="noopener" aria-label="github icon">
        <img loading="lazy" src="/images/logos/github.webp" alt="github"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://www.youtube.com/@arnolanglade" target="_blank" rel="noopener" aria-label="youtube icon">
        <img loading="lazy" src="/images/logos/youtube.webp" alt="youtube"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="/feed.xml" target="_blank" rel="noopener" aria-label="rss icon">
        <img loading="lazy" src="/images/logos/rss.webp" alt="rss"/>
      </a>
    </li>
    
  </ul>
</div>


          <!--bookshop-live end-->
        </nav>

        <div class="nav-button">
          <i class="nav__icon nav__icon-menu ion ion-md-menu"></i>
        </div>

      </div>
    </div>
  </div>
</header>
<!-- end header -->


    <div class="post-top">
  <div class="container">
    <div class="row">

      
      <div class="col col-6 col-d-12">
        <div class="post-image">
          <img loading="lazy" src="/images/posts/what-is-the-event-sourcing-pattern.webp" alt="What is the event sourcing pattern?">
        </div>
      </div>
      

      <div class="col col-6 col-d-12">
        <div class="post__info">

          
          <div class="post-tags">
            
              <a href="/tag/software-architecture" class="post-tags__tag">software-architecture</a>
            
          </div>
          

          <h1 class="post__title">What is the event sourcing pattern?</h1>

          <div class="post__meta">
            <div class="post__meta-bottom">
              <time class="post__date" datetime="2022-11-28T00:00:00-06:00">
                28 Nov 2022
              </time>
              
              <p class="post__image-credit">
                Picture: <a class="post__image-credit-link" href="https://unsplash.com/@vitsinkevich">@vitsinkevich</a>
              </p>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- begin post -->
<div class="container animate">

  <article class="post">

    <div class="post__content">
      <p>Event sourcing consists in storing all changes that happened to an application as a sequence of events instead of only storing the current state of the application. The sum of all events is the current application state. When I heard about this pattern a few years ago, I was really confused. I used to only persist the current application state in a database and that was fine! So I asked myself do I need that?</p>

<p>I will show you an example to help you understand what this pattern stands for. People used to explain it with a bank account but I wanted to find something funnier: a table soccer game. A complete example is available on a Github repository:</p>

<div class="post__navigation blog-post-link">
   <a class="post__prev" href="https://github.com/arnolanglade/table-soccer">
      <span class="prev__image">
         <img loading="lazy" src="/images/posts/github-logo.png" alt="Have a look at the GitHub repository" />
      </span>
      <span class="prev__box">
         <span class="post__nav__title">Have a look at the GitHub repository</span>
      </span>
   </a>
</div>

<p>Let’s start! A group of developers who are fans of table soccer wants to create an application to see who’s the best player. They decided to save the results of matches and rank themselves.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">Game</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="nx">redTeam</span><span class="p">:</span> <span class="nx">Team</span><span class="p">,</span>
        <span class="k">private</span> <span class="nx">blueTeam</span><span class="p">:</span> <span class="nx">Team</span><span class="p">,</span>
        <span class="k">private</span> <span class="nx">gameScore</span><span class="p">:</span> <span class="nx">Score</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="nx">recordScore</span><span class="p">(</span><span class="nx">redPlayerScore</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">bluePlayerScore</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">(</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redTeam</span><span class="p">,</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">blueTeam</span><span class="p">,</span>
            <span class="k">new</span> <span class="nx">Score</span><span class="p">(</span><span class="nx">redPlayerScore</span><span class="p">,</span> <span class="nx">bluePlayerScore</span><span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// example: ['arn0', 'momos', 'Popeye', 'coco', 10, 1]</span>
    <span class="k">public</span> <span class="nx">toState</span><span class="p">():</span> <span class="p">[</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="p">,</span> <span class="kr">number</span><span class="p">,</span> <span class="kr">number</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">redTeam</span><span class="p">.</span><span class="nx">toState</span><span class="p">(),</span>
            <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">blueTeam</span><span class="p">.</span><span class="nx">toState</span><span class="p">(),</span>
            <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">gameScore</span><span class="p">.</span><span class="nx">toState</span><span class="p">()</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Game</code> Aggregate has a <code class="language-plaintext highlighter-rouge">recordScore</code> method to record the score at the end of the game. Then we get the current state of <code class="language-plaintext highlighter-rouge">Game</code> with the <code class="language-plaintext highlighter-rouge">toState</code> method to save it in the database.</p>

<p>That works perfectly for the one versus one games but what happens for two versus two games? Let’s focus on one of the players, we will call him Popeye. Actually, Popeye is not a really good player even if he is full of goodwill. He is smart, he always wants to play with the best player to have more chances to win. We cannot know who is the best player with only the result of the game. Who has really scored? Popeye or its teammate?</p>

<p>Event sourcing is the solution. Instead of saving the score of the game, we will store what really happens. We will refactor the <code class="language-plaintext highlighter-rouge">Game</code> aggregate to make it compliant with the event sourcing pattern.</p>

<p>First, we will rework the aggregate construction. We still want to encapsulate its current state but we want to record all events that happened too. In the following example, we added an <code class="language-plaintext highlighter-rouge">events</code> argument to the primary constructor and a named constructor (secondary construct) called <code class="language-plaintext highlighter-rouge">start</code> to the <code class="language-plaintext highlighter-rouge">Game</code> class. From a business point of view, its goal is to initialize the game and from a technical point of view, it lets us record the <code class="language-plaintext highlighter-rouge">GameStarted</code> event.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">Game</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="nx">redTeam</span><span class="p">:</span> <span class="nx">Team</span><span class="p">,</span>
        <span class="k">private</span> <span class="nx">blueTeam</span><span class="p">:</span> <span class="nx">Team</span><span class="p">,</span>
        <span class="k">private</span> <span class="nx">gameScore</span><span class="p">:</span> <span class="nx">Score</span><span class="p">,</span>
        <span class="k">private</span> <span class="nx">events</span><span class="p">:</span> <span class="nx">Event</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">)</span> <span class="p">{}</span>
    
    <span class="k">public</span> <span class="k">static</span> <span class="nx">start</span><span class="p">(</span>
        <span class="nx">redAttacker</span><span class="p">:</span> <span class="nx">Player</span><span class="p">,</span>
        <span class="nx">redDefender</span><span class="p">:</span> <span class="nx">Player</span><span class="p">,</span>
        <span class="nx">blueAttacker</span><span class="p">:</span> <span class="nx">Player</span><span class="p">,</span>
        <span class="nx">blueDefender</span><span class="p">:</span> <span class="nx">Player</span>
    <span class="p">):</span> <span class="nx">Game</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">redTeam</span> <span class="o">=</span> <span class="nx">Team</span><span class="p">.</span><span class="nx">ofTwoPlayer</span><span class="p">(</span><span class="nx">redAttacker</span><span class="p">,</span> <span class="nx">redDefender</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">blueTeam</span> <span class="o">=</span> <span class="nx">Team</span><span class="p">.</span><span class="nx">ofTwoPlayer</span><span class="p">(</span><span class="nx">blueAttacker</span><span class="p">,</span> <span class="nx">blueDefender</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">(</span>
            <span class="nx">redTeam</span><span class="p">,</span>
            <span class="nx">blueTeam</span><span class="p">,</span>
            <span class="nx">Score</span><span class="p">.</span><span class="nx">playersHaveNotScored</span><span class="p">(),</span>
            <span class="p">[</span><span class="k">new</span> <span class="nx">GameStarted</span><span class="p">(</span><span class="nx">redTeam</span><span class="p">,</span> <span class="nx">blueTeam</span><span class="p">)],</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then we will add a new method to <code class="language-plaintext highlighter-rouge">Game</code> to record all goals scored by any players. That will let us know who is the best striker in the game. In the following example, we record two events: <code class="language-plaintext highlighter-rouge">GoalScored</code> and <code class="language-plaintext highlighter-rouge">GameEnded</code>. The first one is recorded every time a player scores and the second one is recorded when the first team has 10 points meaning the game is over.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">Game</span> <span class="p">{</span> 
   <span class="c1">// …</span>
   <span class="k">public</span> <span class="nx">goalScoredBy</span><span class="p">(</span><span class="nx">player</span><span class="p">:</span> <span class="nx">Player</span><span class="p">):</span> <span class="nx">Game</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">teamColor</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">redTeam</span><span class="p">.</span><span class="nx">isTeammate</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span> <span class="p">?</span> <span class="nx">TeamColor</span><span class="p">.</span><span class="nx">Red</span> <span class="p">:</span> <span class="nx">TeamColor</span><span class="p">.</span><span class="nx">Blue</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">gameScore</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gameScore</span><span class="p">.</span><span class="nx">increase</span><span class="p">(</span><span class="nx">teamColor</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">GoalScored</span><span class="p">(</span><span class="nx">teamColor</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">gameScore</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gameScore</span><span class="p">.</span><span class="nx">canIncrease</span><span class="p">(</span><span class="nx">teamColor</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">GameEnded</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">redTeam</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">blueTeam</span><span class="p">,</span> <span class="nx">gameScore</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">(</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redTeam</span><span class="p">,</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">blueTeam</span><span class="p">,</span>
            <span class="nx">gameScore</span><span class="p">,</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// …</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Note:</strong> We can drop the <code class="language-plaintext highlighter-rouge">recordScore</code> method because we won’t want to only record the score of the game at the end of the game.</p>

<p>Finally, the last thing to refactor is the persistence mechanism. We need to rework the <code class="language-plaintext highlighter-rouge">toState</code> because we won’t store a snapshot of the <code class="language-plaintext highlighter-rouge">Game</code> state but we want to save all events raised during the game. This method will return all serialized events and metadata like the name of the aggregate. Normally, we should persist some extra metadata like the aggregate id or the date when the event has been raised. Then, those data will be used in the <code class="language-plaintext highlighter-rouge">Game</code> repository to persist changes in the database.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">Game</span> <span class="p">{</span> 
    <span class="c1">// …</span>
    <span class="k">public</span> <span class="nx">toState</span><span class="p">():</span> <span class="p">[[</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="p">]]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">event</span><span class="p">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Game</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">toState</span><span class="p">()]);</span>
    <span class="p">}</span>
    <span class="c1">// …</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Last thing, we will add a named constructor to be able to build the object from the persisted state (a list of events). The <code class="language-plaintext highlighter-rouge">fromEvents</code> will iterate on all events to compute and set the current state of a game.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">Game</span> <span class="p">{</span> 
    <span class="c1">// …</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nx">fromEvents</span><span class="p">(</span><span class="nx">events</span><span class="p">:</span> <span class="nx">Event</span><span class="p">[]):</span> <span class="nx">Game</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">redTeam</span><span class="p">,</span> <span class="nx">blueTeam</span><span class="p">,</span> <span class="nx">score</span><span class="p">;</span>
        <span class="nx">events</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">event</span><span class="p">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="nx">event</span> <span class="k">instanceof</span> <span class="na">GameStarted</span><span class="p">:</span>
                    <span class="nx">redTeam</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">redTeam</span><span class="p">;</span>
                    <span class="nx">blueTeam</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">blueTeam</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="nx">event</span> <span class="k">instanceof</span> <span class="na">GameEnded</span><span class="p">:</span>
                    <span class="nx">score</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">score</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="p">});</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">(</span><span class="nx">redTeam</span><span class="p">,</span> <span class="nx">blueTeam</span><span class="p">,</span> <span class="nx">score</span><span class="p">,</span> <span class="nx">events</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// …</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now, we have all the data we need to know if Popeye really helps his teammate. In the following code example, we can see that Momos and arn0 were not in a good shape. Coco and Popeye won easily but we can see that Popeye did not score. Perhaps, he is a good defender, who knows?</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">game</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">startTwoVersusTwo</span><span class="p">(</span><span class="dl">'</span><span class="s1">arn0</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">momos</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Popeye</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">momos</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">arn0</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">arn0</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">momos</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">momos</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">arn0</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">goalScoredBy</span><span class="p">(</span><span class="dl">'</span><span class="s1">coco</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<p>I explained to you how to save <code class="language-plaintext highlighter-rouge">Game</code> aggregate events and create the aggregate from events in the previous sections of the blog post. The last missing feature is the leaderboard! How to create it? It won’t be as simple as querying a SQL table in the database because we need to get all game events for each game and compute them to know who is the better striker. Even though it can be fast in the beginning, the more games you have, the longer it will be.</p>

<p>To prevent this problem, we need to create data projections. That means we will compute a representation of the data we want to query from the event stream. We will compute the new projection of the leaderboard each time a game ends.</p>

<p>Last but not least, We often associate CQRS with the event sourcing pattern even if there are two different patterns.</p>

<p>Don’t forget that a complete example is available on a Github repository.</p>

<div class="post__navigation blog-post-link">
   <a class="post__prev" href="https://github.com/arnolanglade/table-soccer">
      <span class="prev__image">
         <img loading="lazy" src="/images/posts/github-logo.webp" alt="Have a look at the GitHub repository" />
      </span>
      <span class="prev__box">
         <span class="post__nav__title">Have a look at the GitHub repository</span>
      </span>
   </a>
</div>

<p>Any resemblance to real and actual names is purely coincidental!</p>

<p>Thanks to my proofreader <a href="https://www.linkedin.com/in/laurebrosseau">@LaureBrosseau</a>.</p>

    </div>

    <div class="post__share">
  <div class="share__head">
    <div class="share__title"><i class="ion ion-md-heart"></i> Share it if you like it!</div>
  </div>
  <ul class="share__list list-reset">
    <li class="share__item">
      <a class="share__link share__twitter"
        href="https://twitter.com/intent/tweet?text=What%20is%20the%20event%20sourcing%20pattern?&url=https://arnolanglade.github.io/what-is-the-event-sourcing-pattern.html"
        onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
        title="Share on Twitter" rel="nofollow"><i class="ion ion-logo-twitter"></i></a>
    </li>
    <li class="share__item">
      <a class="share__link share__facebook"
        href="https://www.facebook.com/sharer/sharer.php?u=https://arnolanglade.github.io/what-is-the-event-sourcing-pattern.html"
        onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
        title="Share on Facebook" rel="nofollow"><i class="ion ion-logo-facebook"></i></a>
    </li>
    <li class="share__item">
      <a class="share__link share__linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&url=https://arnolanglade.github.io/what-is-the-event-sourcing-pattern.html&title=What%20is%20the%20event%20sourcing%20pattern?&summary=Event%20sourcing%20consists%20in%20storing%20all%20changes%20that%20happened%20to%20the%20application%20state%20as%20a%20sequence%20of%20events%20instead%20of%20only%20storing%20the%20current%20state%20of%20the%20application.%20The%20sum%20of%20all%20events%20makes%20%20the%20current%20application%20state.&source=Arnaud%20Langlade"
        onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
        title="Share on LinkedIn" rel="nofollow"><i class="ion ion-logo-linkedin"></i></a>
    </li>
  </ul>
</div>


  </article>
</div>
<!-- end post -->








<!-- begin related posts -->
<div class="container">
  <section class="related-posts is-related animate">
    <div class="row">
      <div class="col col-12">
        <div class="container__inner">
          <div class="section__info">
            <div class="section__head">
              <h2 class="section__title">You may also like</h2>
              <a class="section__link" href="/blog">
                
                
                  
                    <a href="/tag/software-architecture" class="section__link related-tag">See all<span> software-architecture</span> <i class="ion ion-md-arrow-forward"></i></a>
                  
                
              
              </a>
            </div>
          </div>
          <div class="row">

          
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            

            <!--bookshop-live name(blog-card/blog-card.jekyll.html) params(post=post) context(post=site.posts[11]) -->
          
<div class="c-blog-card col col-4 col-d-6 col-t-12">
  <div class="c-blog-card__inner">

    
    <div class="c-blog-card__image-wrap">
      <a class="c-blog-card__image" href="/what-is-the-difference-between-cqs-and-cqrs-patterns.html">
        <img loading="lazy" src="/images/posts/what-is-the-difference-between-cqs-and-cqrs-patterns.webp" alt="What is the difference between CQS and CQRS patterns?">
      </a>
    </div>
    

    <div class="c-blog-card__content">

      
      <div class="c-blog-card__tags-box">
        
        <a href="/tag/software-architecture" class="c-blog-card__tag">software-architecture</a>
        
        <a href="/tag/design-patterns" class="c-blog-card__tag">design-patterns</a>
        
      </div>
      

      <h2 class="c-blog-card__title">
        <a href="/what-is-the-difference-between-cqs-and-cqrs-patterns.html">What is the difference between CQS and CQRS patterns?</a>
      </h2>

      <p class="c-blog-card__excerpt">
        CQS and CQRS are misunderstood design patterns. They are more simple than people think! CQS is about dividing an object's methods into two categories: commands and queries while CQRS is about separating query and command into two objects.
      </p>

      <div class="c-blog-card__meta">
        <div class="c-blog-card__info">
          <span class="c-blog-card__date"><time datetime="2023-02-06T00:00:00-06:00">06 Feb 2023</time></span>
        </div>
      </div>
    </div>
  </div>
</div>

          <!--bookshop-live end-->

            
                
              
            
            
            

            

            

            <!--bookshop-live name(blog-card/blog-card.jekyll.html) params(post=post) context(post=site.posts[12]) -->
          
<div class="c-blog-card col col-4 col-d-6 col-t-12">
  <div class="c-blog-card__inner">

    
    <div class="c-blog-card__image-wrap">
      <a class="c-blog-card__image" href="/hexagonal-architect-by-example.html">
        <img loading="lazy" src="/images/posts/hexagonal-architecture/hexagonal-architect-by-example.webp" alt="Hexagonal architecture by example">
      </a>
    </div>
    

    <div class="c-blog-card__content">

      
      <div class="c-blog-card__tags-box">
        
        <a href="/tag/software-architecture" class="c-blog-card__tag">software-architecture</a>
        
      </div>
      

      <h2 class="c-blog-card__title">
        <a href="/hexagonal-architect-by-example.html">Hexagonal architecture by example</a>
      </h2>

      <p class="c-blog-card__excerpt">
        The hexagonal architecture, or ports and adapters architecture, is an architectural pattern used in software design. It aims at creating loosely coupled application components that can be easily connected to their software environment by means of ports and adapters.
      </p>

      <div class="c-blog-card__meta">
        <div class="c-blog-card__info">
          <span class="c-blog-card__date"><time datetime="2023-01-09T00:00:00-06:00">09 Jan 2023</time></span>
        </div>
      </div>
    </div>
  </div>
</div>

          <!--bookshop-live end-->

            
                
              
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            
            
            
            

            

            

            <!--bookshop-live name(blog-card/blog-card.jekyll.html) params(post=post) context(post=site.posts[22]) -->
          
<div class="c-blog-card col col-4 col-d-6 col-t-12">
  <div class="c-blog-card__inner">

    
    <div class="c-blog-card__image-wrap">
      <a class="c-blog-card__image" href="/how-did-I-organize-my-last-symfony-project.html">
        <img loading="lazy" src="/images/posts/project-symfony-organization.webp" alt="How did I organize my last Symfony projects?">
      </a>
    </div>
    

    <div class="c-blog-card__content">

      
      <div class="c-blog-card__tags-box">
        
        <a href="/tag/software-architecture" class="c-blog-card__tag">software-architecture</a>
        
        <a href="/tag/symfony" class="c-blog-card__tag">symfony</a>
        
      </div>
      

      <h2 class="c-blog-card__title">
        <a href="/how-did-I-organize-my-last-symfony-project.html">How did I organize my last Symfony projects?</a>
      </h2>

      <p class="c-blog-card__excerpt">
        Return of experience: In this blog post, I will explain how I organized my last Symfony projects. They are mainly inspired by Hexagonal and CQRS architecture.
      </p>

      <div class="c-blog-card__meta">
        <div class="c-blog-card__info">
          <span class="c-blog-card__date"><time datetime="2021-03-30T00:00:00-05:00">30 Mar 2021</time></span>
        </div>
      </div>
    </div>
  </div>
</div>

          <!--bookshop-live end-->

            
                
                  
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
<!-- end related posts -->



  <!-- begin comments -->
<div class="container">
  <div class="row">
    <div class="col col-12">
      <div class="disqus-inner">
        <div id="disqus_thread" class="post__comments">
          <div id="disqus_empty"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function load_disqus() {
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://arnaudlanglade.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  window.addEventListener('scroll', function (e) {
    var currentScroll = document.scrollingElement.scrollTop;
    var disqus_target = document.getElementById('disqus_thread');
    var disqus_empty = document.getElementById('disqus_empty');

    if (disqus_target && disqus_empty && (currentScroll > disqus_target.getBoundingClientRect().top - 150)) {
      load_disqus();
    }
  }, false);

</script>
<noscript>Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- end comments -->



<!--bookshop-live name(newsletter/newsletter.jekyll.html) params(newsletter_title=site.data.newsletter.newsletter_title
newsletter_description=site.data.newsletter.newsletter_description) context() -->
          <!-- begin subscribe -->

<section class="c-subscribe section">
  <div class="container">
    <div class="row">
      <div class="col col-12">

        <div class="c-subscribe__inner">
          <div class="c-subscribe__info">
            <h3 class="c-subscribe__title">Newsletter: Be the first to know!</h3>
            <div class="c-subscribe__subtitle">
              <span id="ityped">Subscribe to my newsletter for updates on my latest blog posts, tech releases, and exclusive content. Stay ahead in the coding game!</span>
            </div>
          </div>

          <form class="c-subscribe__form validate"
                action="https://github.us13.list-manage.com/subscribe/post?u=d7313775f348f8c8d39a841a0&amp;id=28bcb90eaa&amp;f_id=00550ee4f0"
                method="POST"
                id="mc-embedded-subscribe-form"
                name="mc-embedded-subscribe-form"
                target="_blank"
                validate
          >
            <label class="screen-reader-text" for="EMAIL">Email address</label>
            <input class="c-subscribe__form-email required email" id="EMAIL" type="email" name="EMAIL" placeholder="Your email address">
            <button class="c-button c-button--primary c-button--large" id="mc-embedded-subscribe" type="submit" name="subscribe">
              Subscribe
            </button>
          </form>

        </div>
      </div>
    </div>
  </div>
</section>

          <!--bookshop-live end-->


    <!--
        Bookshop components are accessed using the bookshop tag,
        using the same syntax as the standard Jekyll include tag.
    -->
    <!--bookshop-live name(page.jekyll.html) params(content_blocks=page.content_blocks page_theme=page.page_theme) context() -->
          
          <!--bookshop-live end-->

    <div class="top" title="Top"><i class="ion ion-ios-arrow-up"></i></div>

    <!-- begin footer -->
<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col col-12">

        <!--bookshop-live name(social-link.jekyll.html) params() context() -->
          
<div class="social">
  <ul class="social__list list-reset">
    
    <li class="social__item">
      <a class="social__link" href="https://twitter.com/arnolanglade" target="_blank" rel="noopener" aria-label="twitter icon">
        <img loading="lazy" src="/images/logos/twitter.webp" alt="twitter"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://www.linkedin.com/in/arnolanglade" target="_blank" rel="noopener" aria-label="linkedin icon">
        <img loading="lazy" src="/images/logos/linkedin.webp" alt="linkedin"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://bsky.app/profile/arnolanglade.bsky.social" target="_blank" rel="noopener" aria-label="bluesky icon">
        <img loading="lazy" src="/images/logos/bluesky.webp" alt="bluesky"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://mastodon.social/@arnolanglade" target="_blank" rel="noopener" aria-label="mastodon icon">
        <img loading="lazy" src="/images/logos/mastodon.webp" alt="mastodon"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://github.com/arnolanglade" target="_blank" rel="noopener" aria-label="github icon">
        <img loading="lazy" src="/images/logos/github.webp" alt="github"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="https://www.youtube.com/@arnolanglade" target="_blank" rel="noopener" aria-label="youtube icon">
        <img loading="lazy" src="/images/logos/youtube.webp" alt="youtube"/>
      </a>
    </li>
    
    <li class="social__item">
      <a class="social__link" href="/feed.xml" target="_blank" rel="noopener" aria-label="rss icon">
        <img loading="lazy" src="/images/logos/rss.webp" alt="rss"/>
      </a>
    </li>
    
  </ul>
</div>


          <!--bookshop-live end-->

        <ul class="footer_nav list-reset">
          
          <li class="footer_nav__item">
            <a href="/" class="footer_nav__link">Home</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/about/" class="footer_nav__link">About me</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/experiences/" class="footer_nav__link">My experiences</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/talks/" class="footer_nav__link">My talks</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/blog/" class="footer_nav__link">Blog</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/mikado-app/" class="footer_nav__link">MikadoApp</a>
          </li>
          
          <li class="footer_nav__item">
            <a href="/contact/" class="footer_nav__link">Contact</a>
          </li>
          
        </ul>

        <div class="copyright"><p> 2021 &copy; Langlade Arnaud. Template by <a href="https://cloudcannon.com/">CloudCannon</a>.</p></div>

      </div>
    </div>
  </div>
</footer>
<!-- end footer -->

    <!--
        load the live component for CloudCannon live previews.
    -->
    <script>
(function(){
  const bookshopLiveSetup = (CloudCannon) => {
    CloudCannon.enableEvents();

    const head = document.querySelector('head');
    const script = document.createElement('script');
    script.src = `/_cloudcannon/bookshop-live.js`;
    script.onload = function() {
      window.bookshopLive = new window.BookshopLive({
        remoteGlobals: ['/_cloudcannon/bookshop-site-data.json']
      });
      const updateBookshopLive = async () => {
        const frontMatter = await CloudCannon.value();
        const options = window.bookshopLiveOptions || {};
        await window.bookshopLive.update({page: frontMatter}, options);
        CloudCannon?.refreshInterface?.();
      }
      document.addEventListener('cloudcannon:update', updateBookshopLive);
      updateBookshopLive();
    }
    head.appendChild(script);
  }

  document.addEventListener('cloudcannon:load', function (e) {
    bookshopLiveSetup(e.detail.CloudCannon);
  });
})();
</script>

    <script src="/js/scripts.js"></script>
    <script src="/js/common.js"></script>
    <script id="dsq-count-scr" src="//arnaudlanglade.disqus.com/count.js" async></script>
</body>
</html>
